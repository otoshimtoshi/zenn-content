---
title: 'Goï¼ˆv1.23.5ï¼‰ã«ã‚ˆã‚‹Web API ã‚µãƒ¼ãƒãƒ¼ã®ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹'
emoji: 'ğŸ¡'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Go, gin, air, gorm, golangci]
published: true
---

## ã¯ã˜ã‚ã«

ã¯ã˜ã‚ã¾ã—ã¦ã€[otot_dev](https://zenn.dev/otot_dev)ã§ã™ã€‚

- [dockerã§goã®ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ç’°å¢ƒã‚’çˆ†é€Ÿã§æ§‹ç¯‰ã™ã‚‹](https://zenn.dev/otot_dev/articles/d2d7e854448e9a)
- [vscodeã§goã®ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°ç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹](https://zenn.dev/otot_dev/articles/f5492f30f323f5)

Go ã®ç’°å¢ƒæ§‹ç¯‰è¨˜äº‹ã® 3 è¨˜äº‹ç›®ã§ã€â†‘ã®è¨˜äº‹ã®ç¶šç·¨ã¨ã—ã¦ã€ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã—ãŸã®ã§å‚™å¿˜éŒ²ã¨ã—ã¦è¨˜äº‹ã‚’æ›¸ãã¾ã—ãŸã€‚

## æ¦‚è¦

ä¸€èˆ¬çš„ã«ä½¿ç”¨ã•ã‚Œã‚‹ã§ã‚ã‚ã†ã€API ã‚µãƒ¼ãƒãƒ¼ã®ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚
Go ã® Web API ã‚µãƒ¼ãƒãƒ¼ã¨ mariadbï¼ˆMySQLï¼‰ã®æ§‹ç¯‰ã—ã¾ã™ã€‚

## æœ€çµ‚çš„ãªã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ

ä»Šå›ã®ã‚³ãƒ¼ãƒ‰ä¸€å¼ã¯ä»¥ä¸‹ã® URL ã«ã‚ã‚Šã¾ã™ã€‚

https://github.com/otoshimtoshi/go-docker-template/tree/v1.2.0

v1.1.0 ã‹ã‚‰ã®å…¨é‡å·®åˆ†ã¯â†“ã§ç¢ºèªã§ãã¾ã™ã€‚

https://github.com/otoshimtoshi/go-docker-template/compare/v1.1.0...v1.2.0

## ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±

- `go`ï¼šv1.23.5
- `air-verse/air`ï¼šv1.61.7
- `go-delve/delve`: v1.24.0
- `gin-gonic/gin`ï¼šv1.10.0
- `jinzhu/gorm`ï¼šv1.9.16
- `joho/godotenv`ï¼šv1.5.1
- `golang-migrate/migrate/v4`ï¼šv4.18.2

## ä¸€éƒ¨ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç´¹ä»‹

### `gin-gonic/gin`

ï¼ˆé€šç§° Ginï¼‰ã¯ã€Go ã«ã‚ˆã‚Šæ›¸ã‹ã‚ŒãŸè»½é‡ã§é«˜é€Ÿãª Web ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚

**ä¸»ãªç‰¹å¾´**

- é«˜é€Ÿ: net/http ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã§ã‚ã‚Šã€å†…éƒ¨ã§ Radix ãƒ„ãƒªãƒ¼ã‚’ä½¿ç”¨ã—ãŸåŠ¹ç‡çš„ãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’æ¡ç”¨
- ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢: èªè¨¼ã€ãƒ­ã‚®ãƒ³ã‚°ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãªã©ã‚’ç°¡å˜ã«è¿½åŠ å¯èƒ½
- JSON ã®æ‰±ã„ãŒç°¡å˜: ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã® JSON ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãŒç›´æ„Ÿçš„

ã‚·ãƒ³ãƒ—ãƒ«ãª API ã‚µãƒ¼ãƒãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹ã®ã«é©ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

### `jinzhu/gorm`

ï¼ˆé€šç§° GORMï¼‰ã¯ã€Go è¨€èªå‘ã‘ã®å¼·åŠ›ãª O/R ãƒãƒƒãƒ‘ï¼ˆObject-Relational Mapperï¼‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

**ä¸»ãªç‰¹å¾´**

- ã‚·ãƒ³ãƒ—ãƒ«ãª API: Go ã®æ§‹é€ ä½“ã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œãŒç›´æ„Ÿçš„ã«ã§ãã‚‹
- ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†: One-to-Many, Many-to-Many ãªã©ã®é–¢é€£ä»˜ã‘ã‚’ã‚µãƒãƒ¼ãƒˆ
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³: Begin, Commit, Rollback ã§ç°¡å˜ã«åˆ¶å¾¡å¯èƒ½

SQL ã‚’ç›´æ¥æ›¸ã‹ãšã« Go ã®æ§‹é€ ä½“ã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ“ä½œã§ãã‚‹ãŸã‚ã€Go ã§ã® Web é–‹ç™ºã«åºƒãä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚

### `golangci/golangci-lint`

Go è¨€èªå‘ã‘ã®é«˜é€Ÿã§æ‹¡å¼µæ€§ã®ã‚ã‚‹é™çš„è§£æãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

**ä¸»ãªç‰¹å¾´**

- ã‚³ãƒ¼ãƒ‰å“è³ªå‘ä¸Š: ã‚³ãƒ¼ãƒ‰ã®ãƒã‚°ã‚„ã‚¹ã‚¿ã‚¤ãƒ«é•åã‚’æ—©æœŸã«ç™ºè¦‹
- ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½: .golangci.yml ã§æœ‰åŠ¹/ç„¡åŠ¹ã«ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šå¯èƒ½
- CI/CD ã¨ã®çµ±åˆ: GitHub Actions ã‚„ GitLab CI ãªã©ã«ç°¡å˜ã«çµ„ã¿è¾¼ã¿å¯èƒ½

Go ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å“è³ªã‚’ç¶­æŒã™ã‚‹ãŸã‚ã«ã€ã»ã¼ãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ã¨ã—ã¦ä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

ã•ã£ã¨ Web API ã‚µãƒ¼ãƒãƒ¼ã‚’æ§‹ç¯‰ã—ãŸã‹ã£ãŸã®ã§ã€ã‚ã¾ã‚Šã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ§‹æˆã¯æ°—ã«ã—ã›ãšä½œã£ã¦ã‚ã‚Šã¾ã™ã€‚è©³ç´°ã¯ Github ã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ãã ã•ã„ã€‚

https://github.com/otoshimtoshi/go-docker-template

```
.
â”œâ”€â”€ app
â”‚   â”œâ”€â”€ constants
â”‚   â”œâ”€â”€ domain
â”‚   â”œâ”€â”€ infrastructure
â”‚   â”œâ”€â”€ interfaces
â”‚   â”‚   â”œâ”€â”€ controllers
â”‚   â”‚   â””â”€â”€ database
â”‚   â””â”€â”€ usecase
â”œâ”€â”€ migrations
â”œâ”€â”€ seeds
â”‚   â””â”€â”€ seeds
â””â”€â”€ tests
    â””â”€â”€ manual
```

## ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®ç´¹ä»‹

æ§‹æˆã«ã¯è¨˜è¼‰ãŒãªã„ä¸»è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

### `Dockerfile`

Dockerfile ã¯ä»®æƒ³ç’°å¢ƒã‚’ç«‹ã¡ä¸Šã’ã‚‹ãŸã‚ã«å¿…è¦ãªä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã­ã€‚

```dockerfile
#ã€€v1.23.5
FROM golang:1.23-alpine

WORKDIR /app

# v1.61.7
RUN go install github.com/air-verse/air@latest
# v1.24.0
RUN go install github.com/go-delve/delve/cmd/dlv@latest

COPY go.mod go.sum ./
RUN go mod download

# v1.10.0
RUN go get github.com/gin-gonic/gin \
# v1.9.16
    github.com/jinzhu/gorm \
    github.com/jinzhu/gorm/dialects/mysql \
# v1.5.1
    github.com/joho/godotenv

# v4.18.2
RUN go install -tags 'mysql' github.com/golang-migrate/migrate/v4/cmd/migrate@latest

CMD ["air", "-c", ".air.toml"]
```

### `docker-compose.yml`

Web API ã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦ api ã‚³ãƒ³ãƒ†ãƒŠï¼ˆgo-apiï¼‰ã€RDB ã¨ã—ã¦ db ã‚³ãƒ³ãƒ†ãƒŠï¼ˆgo-dbï¼‰ã‚’èµ·å‹•ã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚

```yml
services:
  api:
    container_name: go-api
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - 8080:3000
      - 2345:2345 # ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°ç”¨
    volumes:
      - ./:/app
    depends_on:
      - db
  db:
    container_name: go-db
    image: mariadb:10
    platform: linux/x86_64
    ports:
      - '3306:3306'
    environment:
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: sample
      TZ: 'Asia/Tokyo'
    volumes:
      - sample-db:/var/lib/mysql

volumes:
  sample-db:
    driver: local
```

### `.air.toml`

air ã¯ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã«å¿…è¦ã§ã™ã€‚
[dockerã§goã®ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ç’°å¢ƒã‚’çˆ†é€Ÿã§æ§‹ç¯‰ã™ã‚‹](https://zenn.dev/otot_dev/articles/d2d7e854448e9a)ã®è¨˜äº‹ã§ã‚‚æ›¸ã„ãŸã®ã§ã™ãŒã€ä»¥ä¸‹ã® air èµ·å‹•æ™‚ã®ã‚³ãƒãƒ³ãƒ‰è¨­å®šã‚’ã™ã‚‹ã“ã¨ã§ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚`go-api`ã‚³ãƒ³ãƒ†ãƒŠã®`ports â†’ 2345:2345`ã®è¨­å®šã‚‚é‡è¦ã§ã™ã€‚2345 ãƒãƒ¼ãƒˆã‚’èµ·ç‚¹ã¨ã—ã¦ air ã‚’èµ·å‹•ã•ã›ã¦ã„ã¾ã™ã€‚

```diff toml
# Customize binary, can setup environment variables when run your app.
- full_bin = "APP_ENV=dev APP_USER=air ./tmp/main"
+ full_bin = "APP_ENV=dev APP_USER=air dlv --listen=:2345 --headless=true --api-version=2 --accept-multiclient exec --continue ./tmp/main"
```

### `.golangci.yml`

Go è¨€èªå‘ã‘ã®é«˜é€Ÿã§æ‹¡å¼µæ€§ã®ã‚ã‚‹é™çš„è§£æãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã“ã‚ŒãŒã‚ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€é–‹ç™ºæ™‚ã®ã‚³ãƒ¼ãƒ‰å“è³ªã‚’ä¸€å®šã«ä¿ã¤ã“ã¨ãŒã§ãã¾ã™ã€‚

```
linters:
  enable-all: true
  disable:
    - varnamelen # variable name 'x' is too short for the scope of its usage
    - forbidigo # use of `fmt.Printf` forbidden by pattern `^(fmt\.Print(|f|ln)|print|println)$`
    - godot # Comment should end in a period
    - nonamedreturns # named return "xxxx" with type "[]xxxx.xxxx" found
    - gosmopolitan # string literal contains rune in Han script
    - wsl # assignments should only be cuddled with other assignments
    - depguard # package "github.com/xxxx/xxxx" is not allowed
    - revive
    - stylecheck
    - predeclared
    - gofumpt
    - gci
    - exportloopref
  skip-dirs:
  # ç¾…åˆ—ã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯linterãŒå®Ÿè¡Œã•ã‚Œãªã„
  #  -
  skip-files:
  # ç¾…åˆ—ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯linterãŒå®Ÿè¡Œã•ã‚Œãªã„
  #  -
linters-settings:
  # https://github.com/ldez/tagliatelle?tab=readme-ov-file#examples-1
  tagliatelle:
    case:
      rules:
        json: snake
```

### `.vscode/launch.json`

VS code ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹æ–¹é™å®šã«ã¯ãªã‚Šã¾ã™ãŒã€ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œã™ã‚‹éš›ã«ä½¿ç”¨ã™ã‚‹ launch.json ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Go Debug",
      "type": "go",
      "request": "attach",
      "mode": "remote",
      "port": 2345
    }
  ]
}
```

## å®Ÿéš›ã«å‹•ã‹ã—ã¦ã¿ã‚‹

### Docker

```sh
# ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿè¡Œã®å ´åˆ
% docker compose up -d
# ãƒ­ã‚°å‡ºåŠ›ã‚ã‚Šå®Ÿè¡Œã®å ´åˆ
% docker compose up
```

### Go Modules

Go ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä¾å­˜é–¢ä¿‚ã‚’æ•´ç†ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚

```sh
% go mod tidy
```

### Database Migration

æ§‹ç¯‰ã—ãŸ db ã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦ã€go-api ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã€ãã®å¾Œã€seed ãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥ã—ã¾ã™ã€‚

```sh
% docker exec -it go-api sh
% migrate -database 'mysql://root:password@tcp(go-db:3306)/sample' -path migrations up
% migrate -database 'mysql://root:password@tcp(go-db:3306)/sample' -path migrations down
% go run seeds/seeder.go
```

### Linting

Go ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®ã‚³ãƒ¼ãƒ‰ã‚’é™çš„è§£æã—ã€å•é¡Œï¼ˆãƒã‚°ã€éæ¨å¥¨ãªè¨˜è¿°ã€ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«é•åã€...etcï¼‰ã‚’ç¢ºèªã—ã¾ã™ã€‚

```sh
% golangci-lint run
% golangci-lint run --fix
```
