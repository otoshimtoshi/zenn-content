---
title: 'dockerã§goã®ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ç’°å¢ƒã‚’çˆ†é€Ÿã§æ§‹ç¯‰ã™ã‚‹'
emoji: 'ğŸ³'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Go, Docker, go, docker, airverse]
published: true
---

## ã¯ã˜ã‚ã«

ã¯ã˜ã‚ã¾ã—ã¦ã€[otot_dev](https://zenn.dev/otot_dev)ã§ã™ã€‚
ä»Šå›ã¯ã€çˆ†é€Ÿã§ã‚„ã‚‹ã®ã§é–‹ç™ºåŠ¹ç‡çš„ã«çµ¶å¯¾ã«å¿…è¦ãªãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰éƒ¨åˆ†ã‚’ã¾ãšã¯æ§‹ç¯‰ã—ã¾ã™ã€‚

## æœ€çµ‚çš„ãªã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ

ä»Šå›ã®ã‚³ãƒ¼ãƒ‰ä¸€å¼ã¯ä»¥ä¸‹ã® URL ã«ã‚ã‚Šã¾ã™ã€‚
[go-docker-template(v1.0.0)](https://github.com/otoshimtoshi/go-docker-template/tree/v1.0.0)

## ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±

- `go`ï¼šv1.23.5
- `air-verse/air`ï¼šv1.61.7

â€»ã©ã¡ã‚‰ã‚‚`Dockerfile`ä¸Šã¯ latest ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ãã®ãŸã‚ã€åŸ·ç­†æ™‚ç‚¹ã§ã¯ã†ã¾ãã„ãã¾ã—ãŸãŒã€ã‚‚ã—ã‚‚ã†ã¾ãã„ã‹ãªã„å ´åˆã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®šã§åˆ©ç”¨ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

## æ§‹ç¯‰ç·¨

### air-verse/air ã® README

ä»Šå›ã¯ã€docker ã§ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ç’°å¢ƒã‚’æ§‹ç¯‰ã—ãŸã„ã®ã§ã€[air-verse/air å…¬å¼](https://github.com/air-verse/air)ã® README ã‚’è¦‹ã¾ã™ã€‚
é€”ä¸­ã®è¦‹å‡ºã—ã«`Dockerfile`ã€`docker-compose.yaml`ãŒã‚ã‚‹ã®ã§ã“ã¡ã‚‰ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚

### Dockerfile

~~å®¹é‡ãŒæ°—ã«ãªã‚‹äººã¯ãŠã¨ãªã—ã`FROM golang:1.23-alpine`ã§è»½é‡ãªã‚‚ã®ã‚’ä½¿ç”¨ã—ãŸæ–¹ãŒè‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚~~
[go-docker-template(v1.1.0)](https://github.com/otoshimtoshi/go-docker-template/blob/v1.1.0/Dockerfile#L1-L2)ã§ã¯ã‚„ã¯ã‚Šè»½é‡ãªã‚‚ã®ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚

https://github.com/otoshimtoshi/go-docker-template/blob/v1.1.0/Dockerfile#L1-L2

```diff sh
#ã€€v1.23.5
- FROM golang:latest
+ FROM golang:1.23-alpine

WORKDIR /app

# v1.61.7
RUN go install github.com/air-verse/air@latest

COPY go.mod go.sum ./
RUN go mod download

CMD ["air", "-c", ".air.toml"]
```

### docker-compose.yml

```yml
services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - 8080:3000
    volumes:
      - ./:/app
```

### .air.toml

air ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã€‚[å…¬å¼](https://github.com/air-verse/air/blob/master/air_example.toml)ã®ã»ã¼ãã®ã¾ã¾ã«ã—ã¦ã¾ã™ã€‚

```toml
# Config file for [Air](https://github.com/air-verse/air) in TOML format

# Working directory
# . or absolute path, please note that the directories following must be under root.
root = "."
tmp_dir = "tmp"

[build]
# Array of commands to run before each build
pre_cmd = []
# Just plain old shell command. You could use `make` as well.
cmd = "go build -o ./tmp/main ."
# Array of commands to run after ^C
post_cmd = []
# Binary file yields from `cmd`.
bin = "tmp/main"
# Customize binary, can setup environment variables when run your app.
full_bin = "APP_ENV=dev APP_USER=air ./tmp/main"
# Add additional arguments when running binary (bin/full_bin). Will run './tmp/main hello world'.
args_bin = ["hello", "world"]
# Watch these filename extensions.
include_ext = ["go", "tpl", "tmpl", "html"]
# Ignore these filename extensions or directories.
exclude_dir = ["assets", "tmp", "vendor", "frontend/node_modules"]
# Watch these directories if you specified.
include_dir = []
# Watch these files.
include_file = []
# Exclude files.
exclude_file = []
# Exclude specific regular expressions.
exclude_regex = ["_test\\.go"]
# Exclude unchanged files.
exclude_unchanged = true
# Follow symlink for directories
follow_symlink = true
# This log file is placed in your tmp_dir.
log = "air.log"
# Poll files for changes instead of using fsnotify.
poll = false
# Poll interval (defaults to the minimum interval of 500ms).
poll_interval = 500 # ms
# It's not necessary to trigger build each time file changes if it's too frequent.
delay = 0 # ms
# Stop running old binary when build errors occur.
stop_on_error = true
# Send Interrupt signal before killing process (windows does not support this feature)
send_interrupt = false
# Delay after sending Interrupt signal
kill_delay = 500 # nanosecond
# Rerun binary or not
rerun = false
# Delay after each execution
rerun_delay = 500

[log]
# Show log time
time = false
# Only show main log (silences watcher, build, runner)
main_only = false
# silence all logs produced by air
silent = false

[color]
# Customize each part's color. If no color found, use the raw app log.
main = "magenta"
watcher = "cyan"
build = "yellow"
runner = "green"

[misc]
# Delete tmp directory on exit
clean_on_exit = true

[screen]
clear_on_rebuild = true
keep_scroll = true

[proxy]
# Enable live-reloading on the browser.
enabled = true
proxy_port = 8090
app_port = 3000
```

### go.mod

go ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦ã¾ã™ã€‚

```mod
module go-docker-template

go 1.23.5
```

### go.sum

æœ¬æ¥ã¯ä¾å­˜é–¢ä¿‚ãŒç´°ã‹ãè¨˜éŒ²ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãªã‚“ã§ã™ãŒã€ç©ºã®çŠ¶æ…‹ã§æ§‹ã‚ãªã„ã®ã§ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ä½œæˆã—ã¦ã¾ã™ã€‚

### main.go

go ã®å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã€‚

```go
package main

import (
	"fmt"
	"log"
	"net/http"
)

func main() {
	http.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {
		fmt.Fprintf(w, "Hello, World!")
	})

	log.Fatal(http.ListenAndServe(":3000", nil))
}
```

## å®Ÿè¡Œç·¨

`docker compose up`ã§ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚ŒãŸã‚‰ã‚µãƒ¼ãƒãƒ¼ã¯èµ·å‹•ã—ã¦ã¾ã™ã€‚

```
% docker compose up
[+] Running 1/0
 âœ” Container go-docker-template-api-1  Created                                                                                                                     0.0s
Attaching to api-1
api-1  |
api-1  |   __    _   ___
api-1  |  / /\  | | | |_)
api-1  | /_/--\ |_| |_| \_ v1.61.7, built with Go go1.23.5
api-1  |
api-1  | mkdir /app/tmp
api-1  | watching .
api-1  | !exclude tmp
api-1  | Proxy server listening on http://localhost:8090
api-1  | building...
api-1  | running...
```

### ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã®ç¢ºèª

1. ä»¥ä¸‹ã§ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã‹ç¢ºèªã€‚

```
% curl localhost:8080
Hello, World!
```

2. main.go ã‚’æ›´æ–°

```diff go
  http.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {
-   fmt.Fprintf(w, "Hello, World!")
+   fmt.Fprintf(w, "Great!")
  })
```

3. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®å‡ºåŠ›ãŒå¤‰ã‚ã‚‹ã‹ç¢ºèªã€‚

```
% curl localhost:8080
Great!
```

ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ãŒã§ãã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚
