---
title: 'vscodeã§goã®ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°ç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹'
emoji: 'ğŸ³'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Go, Docker, VSCode, godelve]
published: true
---

ä»Šå›ã¯ã€ã€Œ[dockerã§goã®ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ç’°å¢ƒã‚’çˆ†é€Ÿã§æ§‹ç¯‰ã™ã‚‹](https://zenn.dev/otot_dev/articles/d2d7e854448e9a)ã€ã®ç¶šãã¨ã—ã¦ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°ç’°å¢ƒã‚’ä½œæˆã—ã¾ã™ã€‚è‰²ã€…ãªè¨˜äº‹ã‚’è¦‹ã¾ã—ãŸãŒã€VSCode ã§ Go ã®ãƒ‡ãƒãƒƒã‚°ç’°å¢ƒä½œã‚‹ã®ã¯å°‘ã€…æ‰‹ã“ãšã‚Šã¾ã—ãŸã€‚å¿…è¦æœ€å°é™ã®æ§‹æˆã—ã‹è¨˜è¼‰ã—ã¦ã„ãªã„ã®ã§è¦‹é€šã—ã¯è‰¯ã„ã‹ã¨æ€ã„ã¾ã™ã€‚

## æœ€çµ‚çš„ãªã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ

ä»Šå›ã®ã‚³ãƒ¼ãƒ‰ä¸€å¼ã¯ä»¥ä¸‹ã® URL ã«ã‚ã‚Šã¾ã™ã€‚
https://github.com/otoshimtoshi/go-docker-template/tree/v1.1.0

v1.0.0 ã‹ã‚‰ã®å…¨é‡å·®åˆ†ã¯â†“ã§ç¢ºèªã§ãã¾ã™ã€‚

https://github.com/otoshimtoshi/go-docker-template/compare/v1.0.0...v1.1.0

## ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±

- `go`ï¼šv1.23.5
- `air-verse/air`ï¼šv1.61.7
- `go-delve/delve`: v1.24.0

ä½™è«‡ã§ã™ãŒã€Docker ä»®æƒ³ç’°å¢ƒã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸ delve ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•ã¯ä»¥ä¸‹ã®æ–¹æ³•ã§ç¢ºèªã§ãã¾ã™ã€‚

```sh
% docker ps
--
#CONTAINER ID   IMAGE                    COMMAND              CREATED      STATUS         PORTS                                            NAMES
#166e0bffba3a   go-docker-template-api   "air -c .air.toml"   3 days ago   Up 4 minutes   0.0.0.0:2345->2345/tcp, 0.0.0.0:8080->3000/tcp   go-docker-template-api-1
--
% docker exec -it go-docker-template-api-1 /bin/sh
--
% dlv version
# Delve Debugger
# Version: 1.24.0
# Build: $Id: 2d55e4d30150e3fc68e64357e21293d7920fc1f1
```

## v1.0.0ã¨ã®å¤‰æ›´ç‚¹

### .air.toml

```diff toml
# Customize binary, can setup environment variables when run your app.
- full_bin = "APP_ENV=dev APP_USER=air ./tmp/main"
+ full_bin = "APP_ENV=dev APP_USER=air dlv --listen=:2345 --headless=true --api-version=2 --accept-multiclient exec --continue ./tmp/main"
```

### .vscode/launch.json

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Go Debug",
      "type": "go",
      "request": "attach",
      "mode": "remote",
      "port": 2345
    }
  ]
}
```

### Dockerfile

Docker ç’°å¢ƒã«`go-delve/delve`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```diff dockerfile
#ã€€v1.23.5
FROM golang:1.23-alpine

WORKDIR /app

# v1.61.7
RUN go install github.com/air-verse/air@latest
+ RUN go install github.com/go-delve/delve/cmd/dlv@latest

COPY go.mod go.sum ./
RUN go mod download
```

### docker-compose.yml

ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°ç”¨ã® dlv ã‚’èµ·å‹•ã•ã‚Œã‚‹ãƒãƒ¼ãƒˆã‚’è¨­å®šã—ã¾ã™ã€‚

```diff yml
services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - 8080:3000
+      - 2345:2345 # ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°ç”¨
    volumes:
      - ./:/app
```

## ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°ç¢ºèª

Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ã¾ã™ã€‚

```sh
% docker compose up
```

VSCode ã®ãƒ‡ãƒãƒƒã‚°ã‚¿ãƒ–ã‹ã‚‰`Go Debug`ã‚’é¸æŠã—ã¦ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°ã‚’èµ·å‹•ã—ã¾ã™ã€‚
ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’è¨­å®šã—ã¦ãŠãã€curl ã‚³ãƒãƒ³ãƒ‰ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡Œã„ã¾ã™ã€‚

```sh
% curl localhost:8080
```

ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã§æ­¢ã¾ã‚Šãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°ç’°å¢ƒãŒæ§‹ç¯‰ã§ãã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚
![](/images/f5492f30f323f5/image1.jpg)
